<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Assignment 5</title>
    <style>
        .slider {
            width: 500px;
            height: 10px;
        }

        #canvas {
            float: left;
            margin-right: 1em;
        }

    </style>
</head>

<body>
    <canvas id="canvas" style="border:1px solid #000000;">
        Your browser does not support the HTML5 canvas tag.
    </canvas>
    <div>
        <p>Lichtquelle X: <span id="lightXOut"></span></p>
        <label for="lightXIn"></label><input type="range" id="lightXIn" min="-250" max="250" class="slider">
    </div>
    <div>
        <p>Lichtquelle Y: <span id="lightYOut"></span></p>
        <label for="lightYIn"></label><input type="range" id="lightYIn" min="-250" max="250" class="slider">
    </div>
    <div>
        <p>Lichtquelle Z: <span id="lightZOut"></span></p>
        <label for="lightZIn"></label><input type="range" id="lightZIn" min="-500" max="0" step="0.01" class="slider">
    </div>
    <div>
        <p>Ambient: <span id="ambientOut"></span></p>
        <label for="ambientIn"></label><input type="range" id="ambientIn" min="0" max="1" step="0.01" class="slider">
    </div>
    <div>
        <p>Diffuse: <span id="diffuseOut"></span></p>
        <label for="diffuseIn"></label><input type="range" id="diffuseIn" min="0" max="1" step="0.01" class="slider">
    </div>
    <div>
        <p>Specular: <span id="specularOut"></span></p>
        <label for="specularIn"></label><input type="range" id="specularIn" min="0" max="1" step="0.01" class="slider">
    </div>
    <div>
        <p>Shininess: <span id="shininessOut"></span></p>
        <label for="shininessIn"></label><input type="range" id="shininessIn" min="0.1" max="100" step="0.1" class="slider">
    </div>
    <script>

        const V = [
            -0.130201, 0.911892, 0.385355,
            -0.835719, 0.181125, -0.514941,
            -0.444998, 0.511221, 0.732569,
            -0.175901, 0.104547, -0.977721,
            -0.183114, 0.499171, -0.845227,
            0.417358, -0.781188, -0.45827,
            -0.208951, 0.95725, -0.196934,
            -0.510213, 0.840171, -0.172832,
            0.777264, 0.424533, -0.457665,
            -0.462996, -0.395069, 0.789637,
            0.834949, 0.518755, -0.172154,
            -0.483082, 0.398564, -0.775688,
            0.0634395, 0.964957, -0.245431,
            0.232149, 0.953994, -0.179133,
            0.203851, 0.846013, -0.49176,
            0.562523, 0.80878, -0.160036,
            0.155083, 0.12256, -0.978143,
            0.532448, 0.159618, -0.828597,
            0.177838, 0.479087, -0.857519,
            0.942208, 0.312202, 0.110426,
            0.51469, -0.837037, -0.174682,
            -0.796364, 0.445648, -0.402875,
            0.97047, -0.0214939, -0.232008,
            0.959338, -0.208353, -0.185104,
            0.87528, -0.0634283, -0.476296,
            0.807517, -0.557525, -0.182487,
            0.181213, -0.0676418, -0.979339,
            0.152378, -0.511968, -0.842758,
            0.498792, -0.177641, -0.84645,
            -0.0195684, -0.970496, -0.232289,
            -0.207748, -0.959838, -0.182856,
            -0.100409, -0.854168, -0.507797,
            -0.553058, -0.811191, -0.178814,
            -0.166438, -0.111447, -0.978106,
            -0.487784, -0.167745, -0.854914,
            -0.186114, -0.487526, -0.85157,
            -0.98994, -0.0823396, -0.105967,
            -0.839476, -0.515202, -0.159364,
            -0.864544, -0.157053, -0.473135,
            -0.104867, -0.0115858, 0.993597,
            -0.522628, 0.110348, 0.84366,
            -0.413706, 0.77364, -0.474221,
            -0.967782, 0.238964, 0.0405351,
            -0.959414, 0.183379, 0.209095,
            -0.854171, 0.507577, 0.102278,
            -0.808502, 0.170261, 0.559794,
            -0.0973772, 0.990856, 0.087493,
            -0.150175, 0.839864, 0.517228,
            -0.470472, 0.862714, 0.174027,
            0.989862, 0.106979, 0.0808807,
            0.834402, 0.143334, 0.527928,
            0.876778, 0.459665, 0.128464,
            0.0728722, 0.217524, 0.971547,
            0.215723, 0.188272, 0.956878,
            0.0530069, 0.477176, 0.875538,
            0.558572, 0.183803, 0.806563,
            0.112024, 0.980254, 0.151553,
            0.532492, 0.826635, 0.169173,
            0.18654, 0.850116, 0.49017,
            0.109314, -0.989495, 0.0812968,
            0.145103, -0.83888, 0.520261,
            0.459174, -0.877182, 0.127515,
            0.194553, -0.11208, 0.973749,
            0.132016, -0.237564, 0.960063,
            0.479671, -0.011383, 0.876351,
            0.171538, -0.553748, 0.81221,
            0.981043, -0.107393, 0.150932,
            0.827713, -0.532145, 0.164968,
            0.849083, -0.190156, 0.490841,
            -0.101571, -0.981419, 0.154246,
            -0.530564, -0.827995, 0.1687,
            -0.135484, -0.86872, 0.472957,
            -0.981115, -0.154614, 0.10323,
            -0.828015, -0.169149, 0.530395,
            -0.868887, -0.473069, 0.134293,
            -0.13012, -0.192435, 0.971285,
            -0.171376, -0.522236, 0.832912,
            -0.472023, -0.0723354, 0.8768,
            -0.263175, 0.782526, -0.559258,
            -0.817042, 0.519651, -0.241434,
            -0.572221, 0.250466, -0.777813,
            0.234685, 0.635665, -0.731012,
            0.798841, 0.257811, -0.539543,
            0.620561, 0.70604, -0.337122,
            0.63851, -0.257507, -0.721023,
            0.254528, -0.803191, -0.534487,
            0.693006, -0.622546, -0.357847,
            -0.747173, -0.224092, -0.620886,
            -0.606783, -0.704067, -0.362025,
            -0.237695, -0.655772, -0.7128,
            -0.64265, 0.722468, 0.242429,
            -0.263538, 0.573588, 0.771938,
            -0.696985, 0.334925, 0.630782,
            0.256446, 0.725182, 0.634063,
            0.799707, 0.546417, 0.240735,
            0.623983, 0.352357, 0.69453,
            0.724362, -0.258363, 0.63428,
            0.5463, -0.800128, 0.239642,
            0.347559, -0.622588, 0.698472,
            -0.5598, -0.225847, 0.795615,
            -0.242324, -0.793619, 0.554716,
            -0.793855, -0.554917, 0.241299,
            -0.914571, 0.305891, -0.25869,
            -0.957147, -0.281468, -0.0377424,
            -0.333216, 0.201267, -0.919572,
            -0.175326, 0.30836, -0.933401,
            -0.255241, 0.911131, -0.317471,
            -0.906268, 0.179284, -0.377312,
            0.94496, 0.168596, -0.272348,
            0.039627, -0.956902, 0.282027,
            0.330796, 0.896989, -0.287515,
            -0.290028, -0.0857357, 0.952359,
            0.281781, 0.355649, -0.888535,
            0.286114, 0.212865, -0.933021,
            0.169763, -0.945048, -0.271295,
            -0.911544, -0.382098, -0.139273,
            0.903557, -0.292144, -0.310505,
            0.256872, -0.961553, -0.0723455,
            0.371516, -0.263944, -0.887379,
            0.229292, -0.240746, -0.940626,
            -0.292307, -0.904711, -0.306947,
            0.956945, 0.0318946, 0.283497,
            -0.296083, -0.377077, -0.875489,
            -0.32288, -0.223677, -0.917821,
            -0.89835, -0.256597, -0.349526,
            -0.942301, -0.257835, -0.205827,
            -0.201645, 0.290681, 0.93452,
            -0.242562, 0.112051, 0.961862,
            -0.903479, 0.307319, 0.296269,
            -0.345039, 0.9185, -0.181401,
            -0.344881, 0.896042, 0.271348,
            -0.199201, 0.942664, 0.261868,
            0.882918, 0.382515, 0.263812,
            0.940039, 0.210349, 0.261921,
            0.289272, 0.308593, 0.905096,
            0.96143, 0.257309, -0.0725476,
            0.281233, 0.884952, 0.364806,
            0.274192, 0.934435, 0.219407,
            0.383197, -0.882914, 0.262896,
            0.21308, -0.939689, 0.260522,
            0.276068, -0.253407, 0.924554,
            -0.0286627, 0.957515, 0.281951,
            0.884782, -0.282111, 0.36458,
            0.935339, -0.27234, 0.217819,
            -0.26636, -0.876078, 0.397369,
            -0.265715, -0.934443, 0.227852,
            -0.87602, -0.397423, 0.26648,
            -0.934185, -0.227983, 0.266566,
            -0.396663, -0.242461, 0.883517,
            -0.255221, -0.25765, 0.929276,
            0.906833, 0.36428, -0.204631,
            -0.247024, 0.965227, -0.0509487,
            0.0324442, -0.22079, -0.972737,
            0.204129, 0.912453, -0.350127,
            -0.959328, 0.0741878, -0.265192,
            0.149742, 0.304991, -0.938669,
            0.401614, 0.143418, -0.90292,
            0.307595, 0.0499646, -0.948201,
            -0.0076693, 0.215242, -0.975357,
            0.361745, -0.907828, -0.204606,
            -0.471761, -0.8817, -6.0873e-05,
            -0.000734659, -0.467238, 0.883851,
            -0.680764, -0.621776, 0.380594,
            -0.380857, -0.680212, 0.622249,
            -0.622689, -0.376836, 0.682117,
            0.933228, 0.0138114, -0.354589,
            0.61477, -0.685382, 0.382977,
            0.663484, -0.415797, 0.618631,
            -0.921106, 0.351163, 0.153408,
            0.685285, 0.61468, 0.383284,
            0.416478, 0.66435, 0.617161,
            -0.583934, 0.4582, 0.664848,
            -0.376457, 0.657968, 0.64775,
            -0.596607, 0.659616, 0.450214,
            -0.44112, -0.621859, -0.644492,
            -0.0580185, -0.74968, -0.656205,
            -0.690399, -0.416171, -0.586793,
            0.0370257, 0.891652, -0.446738,
            0.379381, -0.682984, -0.619978,
            0.617894, -0.41477, -0.664694,
            -0.302566, 0.943508, 0.124678,
            0.677586, 0.391441, -0.618287,
            0.393251, 0.630746, -0.665945,
            -0.63033, 0.384284, -0.671233,
            -0.689759, 0.614017, -0.37639,
            -0.392395, 0.670828, -0.625585,
            0.92255, -0.153813, -0.347065,
            -0.880704, -0.00186062, 0.473261,
            0.345203, -0.117739, -0.928916,
            0.141192, -0.361915, -0.919075,
            0.880502, -0.47334, -0.0047406,
            -0.91563, 0.399895, -0.00214396,
            -0.152367, -0.921761, -0.349829,
            0.477313, 0.878055, 0.00597058,
            -0.159165, -0.312425, -0.93445,
            -0.525444, -0.0149389, -0.848726,
            0.0257256, -0.917631, -0.393119,
            -0.943136, -0.114802, -0.307805,
            -0.855227, 0.299583, -0.420621,
            -0.894478, 0.42076, -0.137428,
            -0.333958, 0.37582, -0.862064,
            -0.483527, 0.132067, -0.863878,
            -0.401152, 0.855028, -0.325474,
            -0.161967, 0.875318, -0.450596,
            0.839513, 0.438247, -0.316782,
            0.883782, 0.120907, -0.448088,
            0.337314, 0.836136, -0.428209,
            0.398374, 0.902484, -0.154391,
            0.408647, 0.285893, -0.865524,
            0.433144, -0.841876, -0.317719,
            0.172827, -0.883226, -0.43136,
            0.85081, -0.255365, -0.454556,
            0.905096, -0.381887, -0.175837,
            0.289174, -0.389742, -0.872374,
            -0.26097, -0.85157, -0.449885,
            -0.380464, -0.906631, -0.170359,
            -0.439569, -0.342744, -0.827651,
            -0.874056, -0.388438, -0.285332,
            -0.376687, 0.222699, 0.897272,
            -0.140594, 0.458862, 0.875071,
            -0.84858, 0.452624, 0.265763,
            -0.905167, 0.169708, 0.384507,
            -0.271707, 0.874722, 0.396774,
            0.868318, 0.278231, 0.407609,
            0.240706, 0.453779, 0.855533,
            0.385583, 0.180077, 0.902895,
            0.408734, 0.864267, 0.290004,
            0.279773, -0.868884, 0.405144,
            0.449935, -0.221386, 0.863214,
            0.159165, -0.379349, 0.909065,
            0.864797, -0.408586, 0.288464,
            -0.407731, -0.863117, 0.295511,
            -0.862891, -0.295641, 0.40818,
            -0.300783, -0.393375, 0.867414,
            -0.546838, 0.657856, -0.513962,
            -0.667983, 0.510769, -0.537479,
            -0.521779, 0.536944, -0.660736,
            0.534005, 0.530262, -0.65685,
            0.65512, 0.563745, -0.497148,
            0.483105, 0.707535, -0.508837,
            0.514903, -0.543521, -0.660019,
            0.547338, -0.663311, -0.505429,
            0.66903, -0.514809, -0.532077,
            -0.60035, -0.586333, -0.53853,
            -0.495031, -0.706462, -0.498442,
            -0.532046, -0.467819, -0.701982,
            -0.463244, 0.7073, 0.529032,
            -0.531202, 0.590869, 0.601862,
            -0.674188, 0.503223, 0.536291,
            0.547523, 0.655764, 0.516157,
            0.668375, 0.497106, 0.54813,
            0.516608, 0.529406, 0.669642,
            0.655411, -0.54724, 0.517019,
            0.496199, -0.667923, 0.5494,
            0.526963, -0.513973, 0.6732,
            -0.512371, -0.539793, 0.66492,
            -0.541554, -0.663447, 0.512345,
            -0.663268, -0.51166, 0.542322,
            -0.716152, 0.212527, -0.66153,
            -0.215087, 0.665048, -0.71234,
            -0.69313, 0.697263, -0.167609,
            0.71738, 0.6744, -0.160383,
            0.121083, 0.773464, -0.619498,
            0.684156, 0.197877, -0.700388,
            0.669941, -0.719367, -0.170643,
            0.775483, -0.163538, -0.606293,
            0.163168, -0.690246, -0.701,
            -0.205808, -0.783381, -0.585122,
            -0.640147, -0.106083, -0.7603,
            0.00355121, 0.00758038, -0.999453,
            -0.637606, -0.769476, 0.0101562,
            -0.015541, -0.636039, 0.770525,
            -0.771624, -0.0156739, 0.63461,
            0.766784, -0.640771, 0.00725658,
            0.640035, 0.0291804, 0.766106,
            0.640532, 0.766494, 0.0155255,
            -0.0625511, 0.617412, 0.781329,
            -0.83292, 0.545387, -0.0683476,
            0.0746062, -0.830117, -0.549138,
            -0.629936, 0.0798892, -0.770261,
            0.793921, 0.0520626, -0.602213,
            -0.079622, 0.787277, -0.608038,
            -0.714938, -0.67415, -0.173925,
            -0.674786, 0.149511, 0.719083,
            -0.779035, 0.589205, 0.209192,
            -0.195123, 0.721795, 0.660004,
            0.713429, 0.166783, 0.677122,
            0.147361, 0.616292, 0.770861,
            0.68064, 0.702353, 0.2021,
            0.157379, -0.717143, 0.675215,
            0.618661, -0.145155, 0.76945,
            0.702443, -0.681284, 0.19952,
            -0.677241, -0.705517, 0.201107,
            -0.708919, -0.199808, 0.673653,
            -0.203304, -0.675504, 0.70646,
            -0.0854131, 0.986635, -0.126899,
            0.9895, 0.0935617, -0.105163,
            0.0939772, -0.989574, -0.104529,
            -0.98258, 0.146791, -0.101294,
            -0.0693503, 0.169968, 0.980953,
            0.0869713, 0.993301, -0.0488398,
            0.0907445, 0.0516463, 0.992973,
            0.993842, -0.0736254, -0.0513321,
            -0.993959, 0.0491703, 0.0734367,
            0.0301526, -0.133859, 0.98838,
            -0.0721272, -0.994017, -0.0493206,
            -0.896642, -0.439605, -0.00617642,
            0.0036104, -0.896281, 0.440647,
            -0.386603, 0.059742, 0.918614,
            0.424057, -0.902742, -0.0307502,
            0.891222, -0.0108622, 0.450561,
            0.902028, 0.425649, -0.0299845,
            0.0075795, 0.893039, 0.447073,
            -0.419841, 0.905583, -0.0141614,
            -0.00753345, -0.42438, -0.903774,
            -0.89976, 0.0257655, -0.430899,
            0.461978, 0.00415754, -0.886164,
            -0.00471246, 0.415166, -0.908276,
            -0.277442, -0.959165, 0.0194744,
            0.00553663, -0.298939, 0.953562,
            -0.958775, -0.0195396, 0.278953,
            0.958889, -0.279583, 0.0144706,
            0.289381, 0.0291419, 0.955592,
            0.287887, 0.956444, 0.0204494,
            -0.0232697, 0.330306, 0.941435,
            -0.947341, 0.303565, -0.0939101,
            -0.785808, -0.462051, 0.404028,
            -0.362161, -0.0111812, -0.930653,
            -0.403826, -0.785941, 0.461996,
            -0.102731, 0.947351, -0.301514,
            -0.343972, -0.544583, 0.760737,
            -0.758635, -0.341785, 0.548876,
            -0.548752, -0.758429, 0.342432,
            0.757558, -0.549015, 0.343919,
            0.568999, -0.33801, 0.745821,
            0.319088, -0.765903, 0.553196,
            0.54877, 0.757264, 0.344947,
            0.342847, 0.570943, 0.742202,
            0.764683, 0.320438, 0.55403,
            -0.324161, 0.780105, 0.530331,
            -0.741104, 0.558577, 0.364767,
            -0.531779, 0.321264, 0.780385,
            -0.755173, -0.532395, -0.375364,
            -0.600033, -0.29313, -0.741607,
            -0.353284, -0.751172, -0.551919,
            0.337018, -0.543259, -0.764876,
            0.741578, -0.34744, -0.568896,
            0.553236, -0.757861, -0.336592,
            0.544685, 0.345776, -0.759837,
            0.301675, 0.750772, -0.583097,
            0.754732, 0.561537, -0.330324,
            -0.550514, 0.755696, -0.345619,
            -0.359993, 0.533999, -0.761051,
            -0.761718, 0.347362, -0.541077,
            0.00836351, 0.626978, -0.778035,
            0.646586, -0.0294219, -0.760154,
            -0.783218, 0.000470987, -0.620594,
            -0.0279822, -0.598935, -0.79772,
            -0.595173, 0.80095, 0.0202193,
            0.0281983, 0.773001, 0.631581,
            0.797457, 0.598748, 0.0350492,
            0.771838, -0.040019, 0.631897,
            0.597353, -0.798678, 0.0317742,
            -0.630596, -0.0428748, 0.772625,
            -0.042258, -0.792126, 0.605383,
            -0.792692, -0.605028, 0.0369428,
            0.909352, 0.132263, 0.390913,
            -0.444778, 0.274765, -0.849983,
            -0.30099, 0.849459, -0.430392,
            0.870297, 0.311899, -0.377727,
            0.464004, 0.825519, -0.316875,
            0.37498, 0.475388, -0.791968,
            0.310042, -0.871904, -0.375632,
            0.815513, -0.435434, -0.376234,
            0.476139, -0.377742, -0.790152,
            -0.431513, -0.822271, -0.365441,
            -0.361974, -0.499371, -0.783757,
            -0.819839, -0.337721, -0.457969,
            -0.333737, 0.406402, 0.849235,
            -0.14493, -0.359975, 0.919178,
            -0.747023, 0.659307, 0.0555007,
            -0.815937, 0.364049, 0.444308,
            -0.905141, -0.144657, 0.396025,
            -0.932119, -0.334147, 0.123226,
            -0.4553, 0.80243, 0.378581,
            -0.395136, -0.90554, 0.144367,
            -0.12283, -0.932169, 0.334181,
            0.792272, 0.449274, 0.406707,
            0.905876, -0.397078, 0.138237,
            0.93057, -0.140265, 0.331063,
            0.434047, 0.375491, 0.816583,
            0.341191, -0.116863, 0.93053,
            0.38486, 0.787809, 0.47424,
            0.449451, -0.792423, 0.406182,
            0.137689, -0.910151, 0.386387,
            0.312644, -0.942107, 0.110031,
            0.365601, -0.424216, 0.826156,
            0.399375, 0.904186, 0.142479,
            0.140134, 0.930864, 0.33032,
            0.787359, -0.385833, 0.474195,
            0.144218, 0.332885, 0.929278
        ];
        const F = [
            186, 116, 211,
            95, 251, 390,
            171, 248, 92,
            359, 58, 312,
            148, 9, 233,
            340, 220, 381,
            327, 34, 195,
            24, 165, 186,
            258, 1, 353,
            182, 237, 371,
            107, 102, 198,
            276, 359, 285,
            279, 356, 258,
            199, 79, 102,
            184, 21, 79,
            72, 36, 103,
            340, 90, 284,
            248, 171, 247,
            78, 259, 185,
            277, 44, 380,
            265, 211, 346,
            104, 367, 200,
            178, 241, 5,
            195, 268, 279,
            200, 352, 4,
            281, 354, 259,
            80, 11, 367,
            183, 11, 80,
            345, 178, 266,
            353, 183, 258,
            236, 185, 352,
            354, 18, 317,
            26, 188, 119,
            260, 7, 351,
            216, 343, 34,
            129, 106, 202,
            234, 236, 235,
            90, 380, 284,
            106, 368, 202,
            185, 41, 78,
            284, 220, 340,
            352, 185, 259,
            236, 183, 235,
            206, 349, 14,
            337, 390, 251,
            311, 10, 360,
            5, 347, 209,
            204, 350, 10,
            181, 238, 8,
            207, 15, 370,
            334, 167, 96,
            181, 8, 82,
            336, 226, 392,
            158, 16, 269,
            204, 369, 8,
            369, 108, 205,
            310, 50, 361,
            84, 355, 265,
            130, 180, 48,
            6, 329, 106,
            180, 130, 131,
            346, 84, 265,
            81, 354, 262,
            17, 316, 156,
            179, 374, 84,
            263, 355, 17,
            13, 110, 153,
            350, 8, 238,
            130, 384, 222,
            316, 188, 157,
            113, 157, 16,
            113, 112, 208,
            4, 317, 105,
            175, 89, 357,
            150, 369, 204,
            33, 269, 152,
            156, 157, 113,
            12, 300, 13,
            165, 205, 108,
            181, 348, 237,
            295, 300, 12,
            99, 363, 293,
            61, 97, 138,
            241, 242, 86,
            309, 20, 362,
            216, 34, 123,
            240, 179, 242,
            209, 20, 159,
            178, 5, 85,
            227, 60, 394,
            152, 194, 33,
            20, 309, 159,
            309, 395, 117,
            332, 162, 292,
            137, 136, 226,
            94, 169, 387,
            189, 152, 119,
            169, 336, 249,
            211, 24, 186,
            10, 311, 150,
            373, 116, 212,
            112, 155, 18,
            205, 165, 24,
            319, 304, 75,
            135, 296, 108,
            136, 398, 58,
            344, 174, 89,
            349, 206, 239,
            258, 80, 279,
            135, 19, 49,
            116, 23, 212,
            26, 269, 16,
            118, 374, 213,
            178, 345, 240,
            38, 377, 124,
            321, 190, 212,
            123, 33, 194,
            267, 175, 31,
            351, 184, 260,
            255, 257, 256,
            343, 87, 268,
            109, 394, 307,
            279, 201, 195,
            291, 67, 333,
            268, 195, 34,
            100, 294, 163,
            100, 364, 294,
            154, 107, 315,
            386, 307, 71,
            164, 331, 257,
            383, 306, 74,
            230, 333, 67,
            229, 161, 65,
            22, 302, 23,
            226, 336, 57,
            98, 254, 396,
            323, 397, 193,
            168, 128, 220,
            91, 285, 172,
            218, 127, 126,
            194, 122, 123,
            268, 34, 343,
            297, 305, 29,
            196, 210, 114,
            321, 23, 302,
            266, 85, 278,
            8, 350, 204,
            24, 280, 205,
            265, 280, 24,
            41, 351, 202,
            354, 317, 4,
            191, 44, 277,
            217, 125, 124,
            24, 211, 265,
            54, 224, 287,
            69, 305, 59,
            292, 270, 70,
            217, 342, 37,
            115, 103, 125,
            66, 302, 49,
            11, 352, 200,
            262, 177, 14,
            96, 167, 399,
            202, 7, 129,
            313, 180, 151,
            214, 31, 192,
            364, 71, 307,
            158, 155, 16,
            68, 399, 142,
            315, 197, 154,
            3, 105, 158,
            238, 181, 237,
            7, 313, 129,
            243, 176, 245,
            342, 176, 243,
            338, 95, 286,
            176, 343, 245,
            398, 136, 137,
            342, 217, 377,
            318, 30, 305,
            221, 45, 381,
            202, 368, 41,
            188, 316, 28,
            152, 269, 26,
            43, 128, 168,
            318, 385, 160,
            215, 160, 32,
            377, 38, 87,
            33, 123, 327,
            122, 376, 216,
            228, 64, 391,
            270, 32, 160,
            3, 327, 104,
            122, 194, 35,
            344, 89, 267,
            245, 174, 243,
            389, 310, 68,
            120, 30, 215,
            393, 138, 97,
            147, 72, 383,
            232, 73, 382,
            158, 105, 317,
            86, 347, 241,
            88, 244, 375,
            365, 101, 74,
            197, 315, 38,
            161, 76, 271,
            151, 180, 46,
            378, 2, 341,
            391, 62, 140,
            319, 161, 229,
            280, 355, 263,
            187, 73, 272,
            233, 76, 379,
            42, 303, 43,
            127, 299, 126,
            382, 320, 147,
            352, 11, 236,
            222, 47, 0,
            209, 372, 5,
            261, 10, 350,
            233, 379, 149,
            230, 67, 388,
            351, 41, 234,
            322, 64, 225,
            124, 197, 38,
            335, 393, 253,
            172, 2, 91,
            98, 65, 289,
            100, 163, 328,
            243, 88, 342,
            140, 228, 391,
            90, 173, 384,
            344, 375, 244,
            231, 385, 145,
            36, 303, 298,
            323, 300, 56,
            69, 145, 318,
            381, 45, 92,
            145, 386, 144,
            167, 334, 254,
            198, 102, 21,
            213, 27, 189,
            95, 55, 286,
            173, 246, 384,
            339, 222, 384,
            241, 178, 240,
            101, 292, 162,
            288, 275, 57,
            251, 95, 250,
            101, 365, 292,
            294, 271, 76,
            128, 381, 220,
            52, 301, 53,
            137, 56, 398,
            284, 380, 44,
            131, 130, 222,
            285, 47, 339,
            83, 15, 261,
            72, 147, 320,
            279, 268, 356,
            194, 314, 35,
            48, 384, 130,
            192, 30, 120,
            88, 32, 282,
            371, 18, 81,
            346, 373, 242,
            102, 107, 154,
            348, 371, 237,
            70, 160, 385,
            264, 20, 347,
            43, 168, 42,
            182, 349, 239,
            182, 371, 81,
            170, 337, 251,
            108, 22, 165,
            213, 345, 27,
            131, 141, 46,
            167, 252, 399,
            355, 28, 316,
            92, 248, 381,
            179, 240, 374,
            355, 84, 28,
            226, 397, 137,
            370, 15, 83,
            357, 266, 175,
            299, 301, 52,
            364, 100, 71,
            358, 260, 380,
            339, 384, 246,
            254, 98, 253,
            270, 292, 365,
            56, 300, 46,
            358, 90, 48,
            380, 90, 358,
            359, 93, 58,
            143, 66, 389,
            143, 389, 142,
            283, 40, 341,
            341, 218, 378,
            59, 395, 139,
            93, 359, 287,
            134, 390, 224,
            132, 19, 51,
            308, 77, 111,
            13, 153, 12,
            301, 299, 39,
            344, 214, 375,
            260, 79, 277,
            332, 231, 328,
            124, 377, 217,
            103, 383, 72,
            224, 54, 400,
            235, 183, 353,
            219, 126, 324,
            271, 65, 161,
            64, 228, 290,
            273, 291, 362,
            166, 97, 291,
            319, 63, 304,
            196, 31, 278,
            207, 13, 323,
            212, 25, 373,
            280, 265, 355,
            66, 143, 321,
            46, 180, 131,
            133, 121, 49,
            334, 96, 290,
            138, 395, 61,
            50, 310, 366,
            191, 42, 168,
            110, 13, 207,
            264, 25, 273,
            44, 220, 284,
            329, 12, 177,
            149, 111, 148,
            75, 39, 111,
            148, 111, 77,
            321, 302, 66,
            138, 393, 227,
            92, 45, 283,
            67, 190, 388,
            318, 305, 69,
            89, 175, 267,
            166, 333, 252,
            321, 388, 190,
            255, 164, 257,
            23, 116, 186,
            114, 29, 196,
            225, 55, 390,
            287, 276, 54,
            400, 134, 224,
            285, 359, 47,
            259, 78, 281,
            110, 370, 206,
            366, 121, 133,
            141, 398, 56,
            301, 304, 62,
            234, 184, 351,
            76, 161, 379,
            341, 92, 283,
            44, 191, 168,
            62, 391, 322,
            289, 60, 335,
            145, 144, 231,
            330, 163, 294,
            22, 108, 296,
            212, 190, 25,
            252, 167, 254,
            230, 388, 143,
            27, 314, 189,
            271, 364, 289,
            127, 111, 39,
            374, 28, 84,
            238, 239, 83,
            208, 348, 17,
            252, 254, 253,
            207, 193, 15,
            392, 58, 93,
            56, 46, 141,
            39, 304, 301,
            397, 323, 137,
            14, 177, 153,
            151, 295, 6,
            47, 312, 0,
            12, 153, 177,
            63, 140, 62,
            146, 326, 232,
            331, 326, 257,
            298, 42, 325,
            90, 340, 173,
            337, 224, 390,
            378, 219, 91,
            19, 311, 51,
            198, 353, 1,
            134, 53, 225,
            139, 138, 227,
            378, 126, 219,
            381, 128, 221,
            285, 91, 276,
            225, 64, 55,
            173, 248, 247,
            324, 126, 299,
            226, 57, 397,
            132, 223, 133,
            203, 78, 368,
            215, 32, 375,
            73, 187, 382,
            30, 192, 29,
            217, 37, 115,
            154, 298, 102,
            21, 353, 198,
            177, 262, 281,
            98, 335, 253,
            206, 14, 153,
            373, 25, 86,
            9, 148, 99,
            3, 104, 105,
            52, 400, 324,
            281, 203, 177,
            312, 398, 141,
            162, 257, 326,
            164, 99, 293,
            114, 159, 117,
            332, 328, 256,
            229, 396, 140,
            318, 160, 215,
            142, 230, 143,
            325, 102, 298,
            85, 266, 178,
            139, 395, 138,
            307, 386, 109,
            86, 242, 373,
            262, 14, 349,
            34, 327, 123,
            266, 27, 345,
            89, 174, 376,
            18, 371, 112,
            152, 189, 314,
            96, 361, 290,
            253, 166, 252,
            227, 394, 139,
            266, 357, 27,
            333, 399, 252,
            190, 67, 273,
            119, 152, 26,
            294, 76, 330,
            278, 31, 175,
            223, 50, 366,
            335, 227, 393,
            233, 330, 76,
            278, 85, 210,
            60, 307, 394,
            159, 114, 372,
            29, 114, 297,
            314, 27, 357,
            77, 99, 148,
            97, 362, 291,
            10, 261, 360,
            29, 305, 30,
            179, 346, 242,
            338, 387, 250,
            329, 6, 295,
            157, 188, 26,
            81, 349, 182,
            243, 174, 244,
            232, 331, 73,
            173, 340, 248,
            72, 303, 36,
            237, 182, 239,
            208, 17, 156,
            263, 17, 348,
            370, 110, 207,
            295, 12, 329,
            348, 208, 371,
            202, 351, 7,
            361, 68, 310,
            333, 166, 291,
            280, 82, 205,
            387, 132, 94,
            150, 108, 369,
            218, 40, 308,
            357, 89, 35,
            290, 228, 334,
            140, 396, 228,
            272, 45, 187,
            349, 81, 262,
            281, 78, 203,
            128, 43, 221,
            329, 177, 203,
            295, 151, 46,
            185, 234, 41,
            287, 224, 337,
            291, 273, 67,
            334, 228, 396,
            120, 375, 214,
            237, 239, 238,
            278, 175, 266,
            327, 195, 201,
            323, 13, 300,
            83, 350, 238,
            155, 112, 113,
            115, 125, 217,
            274, 361, 286,
            231, 332, 70,
            1, 315, 107,
            201, 104, 327,
            198, 1, 107,
            282, 37, 342,
            184, 235, 21,
            270, 365, 282,
            209, 347, 20,
            275, 15, 193,
            235, 184, 234,
            384, 48, 90,
            290, 274, 64,
            299, 52, 324,
            356, 38, 315,
            85, 5, 372,
            390, 55, 95,
            327, 3, 33,
            188, 118, 119,
            362, 97, 61,
            343, 216, 245,
            118, 188, 28,
            189, 119, 213,
            312, 47, 359,
            204, 10, 150,
            346, 211, 373,
            215, 30, 318,
            372, 114, 210,
            357, 35, 314,
            156, 113, 208,
            336, 392, 249,
            275, 288, 360,
            396, 65, 98,
            272, 293, 363,
            218, 341, 40,
            121, 366, 310,
            145, 69, 386,
            335, 98, 289,
            222, 0, 131,
            69, 59, 109,
            146, 383, 74,
            310, 389, 121,
            379, 75, 149,
            394, 109, 139,
            227, 335, 60,
            140, 63, 229,
            59, 305, 297,
            296, 135, 49,
            66, 49, 121,
            334, 396, 254,
            49, 19, 133,
            360, 51, 311,
            132, 387, 223,
            319, 379, 161,
            345, 374, 240,
            116, 373, 211,
            333, 230, 399,
            165, 22, 186,
            249, 251, 250,
            154, 197, 36,
            142, 389, 68,
            350, 83, 261,
            77, 308, 40,
            293, 272, 73,
            325, 42, 191,
            162, 332, 256,
            99, 164, 9,
            286, 361, 50,
            264, 362, 20,
            306, 37, 365,
            16, 155, 113,
            144, 328, 231,
            326, 146, 101,
            87, 176, 377,
            292, 70, 332,
            225, 53, 322,
            298, 154, 36,
            221, 43, 320,
            365, 74, 306,
            240, 242, 241,
            328, 144, 100,
            71, 100, 144,
            354, 81, 18,
            37, 306, 115,
            87, 356, 268,
            216, 376, 245,
            347, 86, 264,
            125, 103, 36,
            348, 181, 263,
            307, 60, 364,
            250, 169, 249,
            206, 370, 239,
            121, 389, 66,
            126, 378, 218,
            58, 392, 136,
            363, 99, 77,
            320, 382, 187,
            277, 380, 260,
            39, 299, 127,
            322, 391, 64,
            183, 236, 11,
            171, 341, 2,
            256, 163, 255,
            282, 365, 37,
            286, 55, 274,
            36, 197, 125,
            301, 62, 322,
            92, 341, 171,
            109, 386, 69,
            23, 186, 22,
            234, 185, 236,
            164, 255, 9,
            147, 383, 146,
            263, 82, 280,
            358, 313, 7,
            4, 259, 354,
            367, 104, 201,
            166, 253, 393,
            353, 21, 235,
            4, 105, 200,
            289, 65, 271,
            323, 193, 207,
            336, 169, 288,
            158, 269, 3,
            93, 337, 170,
            170, 249, 392,
            169, 250, 387,
            112, 371, 208,
            288, 57, 336,
            229, 65, 396,
            250, 95, 338,
            118, 213, 119,
            286, 50, 338,
            83, 239, 370,
            157, 156, 316,
            274, 290, 361,
            135, 150, 311,
            311, 19, 135,
            247, 172, 246,
            362, 61, 309,
            0, 141, 131,
            196, 29, 192,
            273, 362, 264,
            395, 309, 61,
            172, 247, 2,
            31, 214, 267,
            345, 213, 374,
            35, 376, 122,
            174, 344, 244,
            84, 346, 179,
            139, 109, 59,
            3, 269, 33,
            322, 53, 301,
            244, 88, 243,
            375, 120, 215,
            342, 88, 282,
            296, 302, 22,
            174, 245, 376,
            1, 258, 356,
            62, 304, 63,
            388, 321, 143,
            6, 129, 151,
            93, 170, 392,
            172, 339, 246,
            325, 191, 199,
            117, 159, 309,
            298, 303, 42,
            324, 400, 54,
            200, 367, 11,
            219, 54, 276,
            377, 176, 342,
            356, 87, 38,
            9, 330, 233,
            331, 164, 293,
            368, 106, 203,
            203, 106, 329,
            366, 133, 223,
            229, 63, 319,
            111, 127, 308,
            246, 173, 247,
            57, 193, 397,
            40, 363, 77,
            390, 134, 225,
            53, 134, 400,
            220, 44, 168,
            163, 330, 255,
            316, 17, 355,
            271, 294, 364,
            330, 9, 255,
            261, 15, 275,
            398, 312, 58,
            108, 150, 135,
            103, 115, 306,
            276, 91, 219,
            331, 232, 326,
            231, 70, 385,
            274, 55, 64,
            91, 2, 378,
            147, 146, 232,
            144, 386, 71,
            117, 297, 114,
            372, 210, 85,
            272, 363, 283,
            221, 187, 45,
            74, 101, 146,
            356, 315, 1,
            297, 117, 59,
            283, 45, 272,
            79, 21, 102,
            339, 172, 285,
            51, 94, 132,
            199, 102, 325,
            289, 364, 60,
            101, 162, 326,
            279, 80, 201,
            200, 105, 104,
            375, 32, 88,
            317, 155, 158,
            78, 41, 368,
            79, 260, 184,
            149, 75, 111,
            283, 363, 40,
            281, 262, 354,
            337, 93, 287,
            314, 194, 152,
            82, 8, 369,
            399, 68, 96,
            82, 263, 181,
            97, 166, 393,
            80, 258, 183,
            133, 19, 132,
            180, 313, 48,
            222, 339, 47,
            153, 110, 206,
            6, 106, 129,
            151, 129, 313,
            193, 57, 275,
            141, 0, 312,
            159, 372, 209,
            249, 170, 251,
            376, 35, 89,
            306, 383, 103,
            117, 395, 59,
            155, 317, 18,
            360, 94, 51,
            361, 96, 68,
            94, 360, 288,
            149, 148, 233,
            212, 23, 321,
            223, 338, 50,
            347, 5, 241,
            205, 82, 369,
            86, 25, 264,
            142, 399, 230,
            157, 26, 16,
            75, 379, 319,
            273, 25, 190,
            282, 32, 270,
            257, 162, 256,
            160, 70, 270,
            259, 4, 352,
            31, 196, 192,
            201, 80, 367,
            87, 343, 176,
            53, 400, 52,
            49, 302, 296,
            192, 120, 214,
            123, 122, 216,
            278, 210, 196,
            28, 374, 118,
            267, 214, 344,
            308, 127, 218,
            320, 43, 303,
            338, 223, 387,
            385, 318, 145,
            7, 260, 358,
            320, 187, 221,
            277, 79, 199,
            320, 303, 72,
            163, 256, 328,
            340, 381, 248,
            276, 287, 359,
            293, 73, 331,
            277, 199, 191,
            275, 360, 261,
            171, 2, 247,
            358, 48, 313,
            46, 300, 295,
            169, 94, 288,
            136, 392, 226,
            56, 137, 323,
            232, 382, 147,
            75, 304, 39,
            324, 54, 219,
            197, 124, 125
        ];

        const names = ["lightX", "lightY", "lightZ", "ambient", "diffuse", "specular", "shininess"];
        const initialValues = [250, 250, 0, 0.3, 0.7, 0.1, 10];
        let inputs = [];
        for (let i = 0; i < names.length; i++) {
            inputs[names[i]] = initialValues[i];
            let sliderIn = document.getElementById(names[i] + "In");
            let sliderOut = document.getElementById(names[i] + "Out");
            sliderIn.value = inputs[names[i]].toString();
            sliderOut.innerHTML = inputs[names[i]].toString();
            sliderIn.oninput = function () {
                inputs[names[i]] = parseFloat(this.value);
                sliderOut.innerHTML = inputs[names[i]].toString();
                update();
            };
        }

        class Vector {
            constructor(x = 0, y = 0, z = 0) {
                this.x = x;
                this.y = y;
                this.z = z;
                this.w = 0;
            }

            dot(v) {
                return this.x * v.x + this.y * v.y + this.z * v.z;
            }

            cross(v) {
                return new Vector(
                    this.y * v.z - this.z * v.y,
                    this.z * v.x - this.x * v.z,
                    this.x * v.y - this.y * v.x
                );
            }

            norm() {
                return Math.sqrt(this.dot(this));
            }

            normalize() {
                let n = this.norm();
                this.x /= n;
                this.y /= n;
                this.z /= n;
                return this;
            }

            add(v) {
                return new Vector(
                    this.x + v.x,
                    this.y + v.y,
                    this.z + v.z
                );
            }

            sub(v) {
                return new Vector(
                    this.x - v.x,
                    this.y - v.y,
                    this.z - v.z
                );
            }

            mul(s) {
                return new Vector(
                    this.x * s,
                    this.y * s,
                    this.z * s
                );
            }

            mulVec(v) {
                return new Vector(
                    this.x * v.x,
                    this.y * v.y,
                    this.z * v.z
                );
            }
        }

        class Point {
            constructor(x = 0, y = 0, z = 0, w = 1) {
                this.x = x;
                this.y = y;
                this.z = z;
                this.w = w;
            }

            dehomogen() {
                this.x /= this.w;
                this.y /= this.w;
                this.z /= this.w;
                this.w = 1;
                return this;
            }

            sub(p) {
                this.dehomogen();
                p.dehomogen();
                return new Vector(
                    this.x - p.x,
                    this.y - p.y,
                    this.z - p.z
                );
            }
        }

        class Matrix {
            constructor(a00 = 1, a01 = 0, a02 = 0, a03 = 0,
                a10 = 0, a11 = 1, a12 = 0, a13 = 0,
                a20 = 0, a21 = 0, a22 = 1, a23 = 0,
                a30 = 0, a31 = 0, a32 = 0, a33 = 1) {
                this.a00 = a00;
                this.a01 = a01;
                this.a02 = a02;
                this.a03 = a03;
                this.a10 = a10;
                this.a11 = a11;
                this.a12 = a12;
                this.a13 = a13;
                this.a20 = a20;
                this.a21 = a21;
                this.a22 = a22;
                this.a23 = a23;
                this.a30 = a30;
                this.a31 = a31;
                this.a32 = a32;
                this.a33 = a33;
            }

            mulMat(m) {
                return new Matrix(
                    this.a00 * m.a00 + this.a01 * m.a10 + this.a02 * m.a20 + this.a03 * m.a30,
                    this.a00 * m.a01 + this.a01 * m.a11 + this.a02 * m.a21 + this.a03 * m.a31,
                    this.a00 * m.a02 + this.a01 * m.a12 + this.a02 * m.a22 + this.a03 * m.a32,
                    this.a00 * m.a03 + this.a01 * m.a13 + this.a02 * m.a23 + this.a03 * m.a33,
                    this.a10 * m.a00 + this.a11 * m.a10 + this.a12 * m.a20 + this.a13 * m.a30,
                    this.a10 * m.a01 + this.a11 * m.a11 + this.a12 * m.a21 + this.a13 * m.a31,
                    this.a10 * m.a02 + this.a11 * m.a12 + this.a12 * m.a22 + this.a13 * m.a32,
                    this.a10 * m.a03 + this.a11 * m.a13 + this.a12 * m.a23 + this.a13 * m.a33,
                    this.a20 * m.a00 + this.a21 * m.a10 + this.a22 * m.a20 + this.a23 * m.a30,
                    this.a20 * m.a01 + this.a21 * m.a11 + this.a22 * m.a21 + this.a23 * m.a31,
                    this.a20 * m.a02 + this.a21 * m.a12 + this.a22 * m.a22 + this.a23 * m.a32,
                    this.a20 * m.a03 + this.a21 * m.a13 + this.a22 * m.a23 + this.a23 * m.a33,
                    this.a30 * m.a00 + this.a31 * m.a10 + this.a32 * m.a20 + this.a33 * m.a30,
                    this.a30 * m.a01 + this.a31 * m.a11 + this.a32 * m.a21 + this.a33 * m.a31,
                    this.a30 * m.a02 + this.a31 * m.a12 + this.a32 * m.a22 + this.a33 * m.a32,
                    this.a30 * m.a03 + this.a31 * m.a13 + this.a32 * m.a23 + this.a33 * m.a33
                );
            }

            mulVec(v) {
                return new Point(
                    this.a00 * v.x + this.a01 * v.y + this.a02 * v.z + this.a03 * v.w,
                    this.a10 * v.x + this.a11 * v.y + this.a12 * v.z + this.a13 * v.w,
                    this.a20 * v.x + this.a21 * v.y + this.a22 * v.z + this.a23 * v.w,
                    this.a30 * v.x + this.a31 * v.y + this.a32 * v.z + this.a33 * v.w
                );
            }
        }

        class Triangle {
            constructor(a, b, c, color) {
                this.a = a;
                this.b = b;
                this.c = c;
                this.color = color;
            }
        }

        const size = 600;
        const canvas = document.getElementById("canvas");
        canvas.setAttribute("height", size.toString());
        canvas.setAttribute("width", size.toString());
        const ctx = canvas.getContext("2d");
        let image;
        let mouseRotMat = new Matrix();
        const lookAtMat = new Matrix(
            1, 0, 0, 0,
            0, 1, 0, 0,
            0, 0, 1, -250,
            0, 0, 0, 1
        );
        const projectionMat = new Matrix(
            size / 2, 0, 0, 0,
            0, size / 2, 0, 0,
            0, 0, -501 / 499, -1000 / 499,
            0, 0, -1, 0
        );
        const lightColor = new Vector(1, 1, 1);
        let lightPos;
        let colorBuffer = new Array(size).fill(0).map(() => new Array(size));
        let zBuffer = new Array(size).fill(0).map(() => new Array(size));

        function resetBuffers() {

            // TODO: Aufgabe a

            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    colorBuffer[i][j] = new Vector(0, 0, 0);
                    zBuffer[i][j] = Infinity;
                }
            }

        }

        function updateBuffers(row, col, z, color) {

            // TODO: Aufgabe b

            if (z < zBuffer[row][col]) {
                zBuffer[row][col] = z;
                colorBuffer[row][col] = color;
            }

        }

        function draw() {
            ctx.clearRect(0, 0, size, size);
            image = ctx.createImageData(size, size);
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    let c = colorBuffer[i][j];

                    // Bonusaufgabe

                    let pixel = [255 * c.x, 255 * c.y, 255 * c.z, 255];
                    for (let k = 0; k < 4; k++) {
                        image.data[4 * size * i + 4 * j + k] = pixel[k];
                    }
                }
            }
            ctx.putImageData(image, 0, 0);
        }

        function createTriangles() {

            function sphere(position, radius, color) {
                let triangles = [];
                for (let i = 0; i < F.length / 3; i++) {
                    let points = [];
                    for (let j = 0; j < 3; j++) {
                        points.push(new Point(
                            V[3 * F[3 * i + j]] * radius + position.x,
                            V[3 * F[3 * i + j] + 1] * radius + position.y,
                            V[3 * F[3 * i + j] + 2] * radius + position.z));
                    }
                    triangles.push(new Triangle(points[0], points[1], points[2], color));
                }
                return triangles;
            }

            return sphere(new Point(0, 0, 0), 100, new Vector(0, 1, 0.8));
        }

        let triangles = createTriangles();

        function update() {

            function det(a, b, c, d) {
                return a * d - b * c;
            }

            function area(a, b, c) {
                return 0.5 * det(b.x - a.x, c.x - a.x, b.y - a.y, c.y - a.y);
            }

            function light(triangle) {
                let [a, b, c, triColor] = [triangle.a, triangle.b, triangle.c, triangle.color];
                let x = new Point((a.x + b.x + c.x) / 3, (a.y + b.y + c.y) / 3, (a.z + b.z + c.z) / 3);
                let v = new Point(0, 0, 0).sub(x).normalize();
                let l = lightPos.sub(x).normalize();
                let n = b.sub(a).cross(c.sub(a)).normalize();
                let r = n.mul(2).mul(n.dot(l)).sub(l);
                let ca = triColor.mul(inputs["ambient"]);
                let cd = triColor.mul(inputs["diffuse"]);
                let cs = new Vector(1, 1, 1).mul(inputs["specular"]);
                let s = inputs["shininess"];
                let phongColor = ca.add(cd.mul(Math.max(0, l.dot(n)))).add(cs.mul(Math.pow(Math.max(0, v.dot(r)), s))).mulVec(lightColor);
                phongColor.x = Math.min(1, phongColor.x);
                phongColor.y = Math.min(1, phongColor.y);
                phongColor.z = Math.min(1, phongColor.z);
                return phongColor;
            }

            resetBuffers();
            lightPos = new Point(inputs["lightX"], inputs["lightY"], inputs["lightZ"]);
            let modelViewMat = lookAtMat.mulMat(mouseRotMat);
            for (let i = 0; i < triangles.length; i++) {
                let points = [triangles[i].a, triangles[i].b, triangles[i].c];
                for (let j = 0; j < 3; j++) {
                    points[j] = modelViewMat.mulVec(points[j]);
                }
                let transformed = new Triangle(points[0], points[1], points[2], triangles[i].color, triangles[i].alpha);
                for (let j = 0; j < 3; j++) {
                    points[j] = projectionMat.mulVec(points[j]).dehomogen();
                }
                let [a, b, c] = points;
                for (let x = Math.max(-size / 2, Math.round(Math.min(a.x, b.x, c.x)));
                    x <= Math.min(size / 2, Math.round(Math.max(a.x, b.x, c.x)));
                    x++) {
                    for (let y = Math.max(-size / 2, Math.round(Math.min(a.y, b.y, c.y)));
                        y <= Math.min(size / 2, Math.round(Math.max(a.y, b.y, c.y)));
                        y++) {
                        let p = new Point(x, y);
                        let tArea = area(a, b, c);
                        let [alpha, beta, gamma] = [area(p, b, c) / tArea, area(p, c, a) / tArea, area(p, a, b) / tArea];
                        if (alpha >= 0 && beta >= 0 && gamma >= 0) {
                            let z = alpha * a.z + beta * b.z + gamma * c.z;
                            let row = -y + size / 2;
                            let col = x + size / 2;
                            updateBuffers(row, col, z, light(transformed));
                        }
                    }
                }
            }
            draw();
        }

        update();

        let down = false;
        let x0;
        let y0;

        document.getElementById("canvas").addEventListener("mousedown", function (event) {
            down = true;
            x0 = event.clientX - size / 2;
            y0 = size / 2 - event.clientY;
        });

        document.getElementById("canvas").addEventListener("mousemove", function (event) {
            if (down) {
                let x1 = event.clientX - size / 2;
                let y1 = size / 2 - event.clientY;
                if (x0 !== x1 || y0 !== y1) {
                    let v0 = new Vector(x0, y0, size / 2);
                    v0.normalize();
                    let v1 = new Vector(x1, y1, size / 2);
                    v1.normalize();
                    if (v0.sub(v1).norm() > 0.001) {
                        let n = v0.cross(v1);
                        let sin = n.norm();
                        let cos = v0.dot(v1);
                        n.normalize();
                        mouseRotMat = new Matrix(
                            (1 - cos) * n.x * n.x + cos, (1 - cos) * n.x * n.y - sin * n.z, (1 - cos) * n.x * n.z + sin * n.y, 0,
                            (1 - cos) * n.y * n.x + sin * n.z, (1 - cos) * n.y * n.y + cos, (1 - cos) * n.y * n.z - sin * n.x, 0,
                            (1 - cos) * n.z * n.x - sin * n.y, (1 - cos) * n.z * n.y + sin * n.x, (1 - cos) * n.z * n.z + cos, 0,
                            0, 0, 0, 1
                        ).mulMat(mouseRotMat);
                    }
                    update();
                    x0 = x1;
                    y0 = y1;
                }
            }
        });

        document.getElementById("canvas").addEventListener("mouseup", function () {
            down = false;
        });

    </script>
</body>

</html>
